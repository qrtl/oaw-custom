<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.rule" id="supplier_stock_supplier_rule">
            <field name="name">partner_stock: stock supplier: Access on own stock</field>
            <field name="model_id" ref="supplier_stock.model_supplier_stock"/>
            <field name="domain_force">[('partner_id', 'child_of', user.commercial_partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_supplier'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
            <field name="perm_write" eval="True"/>
        </record>

        <record model="ir.rule" id="supplier_location_supplier_rule">
            <field name="name">supplier_location: stock supplier: Access on own location</field>
            <field name="model_id"
                   ref="supplier_stock.model_supplier_location"/>
            <field name="domain_force">[('owner_id', 'child_of', user.commercial_partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_supplier'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
            <field name="perm_write" eval="True"/>
        </record>

        <record model="ir.rule" id="res_partner_supplier_rule">
            <field name="name">res_partner: stock supplier: Access on res.partner</field>
            <field name="model_id"
                   ref="base.model_res_partner"/>
            <field name="domain_force">['|',('id', 'child_of', user.commercial_partner_id.id), ('related_partner', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_supplier'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="False"/>
        </record>



        <!--Supplier FM sees only his own quants of internal location -->
         <record model="ir.rule" id="quants_supplier_fm">
            <field name="name">stock.quant: stock supplier_fm: Sees his quants in internal location</field>
            <field name="model_id"
                   ref="stock.model_stock_quant"/>
            <field name="domain_force">[('owner_id', 'child_of', user.commercial_partner_id.id),('location_id.usage', '=', 'internal')]</field>
            <field name="groups" eval="[(4, ref('group_supplier_fm'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="False"/>
        </record>

        <!--Supplier FM sees only stock moves where he is the owner-->
         <record model="ir.rule" id="stock_move_supplier_fm">
            <field name="name">stock.move: stock supplier_fm: Sees his stock moves</field>
            <field name="model_id"
                   ref="stock.model_stock_move"/>
            <field name="domain_force">[('quant_owner_id', 'child_of', user.commercial_partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_supplier_fm'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="False"/>
        </record>
        <!--Narrow down shown product_templates to supplier_fm-->
         <record model="ir.rule" id="res_partner_supplier_fm_product_rule">
            <field name="name">product_template: stock supplier_fm: Sees on certain categories</field>
            <field name="model_id"
                   ref="product.model_product_template"/>
            <field name="domain_force">[('categ_id', 'in', user.product_category_ids.ids)]</field>
            <field name="groups" eval="[(4, ref('group_supplier_fm'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="False"/>
        </record>
        <!--Narrow down quotation accessible to those created by the supplier_fm-->
        <record model="ir.rule" id="res_partner_supplier_fm_sale_rule">
            <field name="name">sale_order: stock supplier_fm: Access on own quotation; but no delete(no unlink)</field>
            <field name="model_id"
                   ref="sale.model_sale_order"/>
            <field name="domain_force">[('create_uid','child_of', user.commercial_partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_supplier_fm'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="True"/>
        </record>


    </data>
</openerp>
